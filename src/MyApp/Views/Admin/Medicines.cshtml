@model IReadOnlyList<MyApp.Domain.Medicines.MedicineDto>
@{
    var infoMsg = TempData["Info"] as string;
    var errMsg = TempData["Error"] as string;
}

<partial name="~/Views/Shared/_AdminNav.cshtml" />

<div class="container mt-3">
    @if (!string.IsNullOrWhiteSpace(infoMsg) || !string.IsNullOrWhiteSpace(errMsg))
    {
        <div class="toast-container position-fixed top-0 end-0 p-3 z-3" style="pointer-events: none;">
            @if (!string.IsNullOrWhiteSpace(infoMsg))
            {
                <div class="toast text-bg-success border-0 mb-2" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="5000" style="pointer-events: auto;">
                    <div class="toast-header bg-success text-white">
                        <strong class="me-auto">Success</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                        @infoMsg
                    </div>
                </div>
            }
            @if (!string.IsNullOrWhiteSpace(errMsg))
            {
                <div class="toast text-bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="false" style="pointer-events: auto;">
                    <div class="toast-header bg-danger text-white">
                        <strong class="me-auto">Error</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                        @errMsg
                    </div>
                </div>
            }
        </div>

        @section Scripts {
            <script>
                (function () {
                    var toasts = document.querySelectorAll('.toast');
                    toasts.forEach(function (el) {
                        var t = new bootstrap.Toast(el);
                        t.show();
                    });
                })();
            </script>
        }
    }

    <div class="mb-3">
        <form asp-action="AddMedicine" asp-controller="Admin" method="post" class="row g-2">
            @Html.AntiForgeryToken()
            <div class="col-sm-3">
                <input name="Code" class="form-control" placeholder="Code" maxlength="64" required />
            </div>
            <div class="col-sm-7">
                <input name="Name" class="form-control" placeholder="Name" maxlength="256" required />
            </div>
            <div class="col-sm-2 d-grid">
                <button type="submit" class="btn btn-primary">Add</button>
            </div>
        </form>
    </div>

    <div class="table-responsive">
        <table class="table table-striped align-middle">
            <thead>
                <tr>
                    <th scope="col" class="col-1">Id</th>
                    <th scope="col" class="col-2">Code</th>
                    <th scope="col">Name</th>
                    <th scope="col" class="col-1"></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.Id</td>
                        <td>@item.Code</td>
                        <td>@item.Name</td>
                        <td>
                            <form asp-action="DeleteMedicine" asp-controller="Admin" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@item.Id" />
                                <button type="submit" class="btn btn-sm btn-outline-danger"
                                        onclick="return confirm('Delete this medicine?');">
                                    Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
