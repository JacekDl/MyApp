@model MyApp.Web.ViewModels.DateMedicinesViewModel
@{
    Layout = "~/Views/Shared/_PatientLayout.cshtml";
    var d = Model.Date.Date;
    var isFutureDay = Model.Date.Date > DateTime.Today;
}
<h3 class="mb-3">
    Leki do przyjęcia: @d.ToString("dd.MM.yyyy - dddd ", new System.Globalization.CultureInfo("pl-PL"))
</h3>

@if (Model.Morning.Any())
{
    <div class="card mb-3">
        <div class="card-header text-center">
            Rano
        </div>
        <ul class="list-group list-group-flush">
            @foreach(var m in Model.Morning)
            {
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <label class="mb-0 flex-grow-1" for="med-@m.IdMedicine">
                        @m.MedicineName – @m.Dosage
                    </label>

                    <form asp-action="ToggleMedicineTaken" method="post" class="m-0">
                        @Html.AntiForgeryToken()

                        <input type="hidden" name="date" value="@Model.Date.ToString("yyyy-MM-dd")" />
                        <input type="hidden" name="treatmentPlanMedicineId" value="@m.IdMedicine" />

                        <input class="form-check-input ms-2"
                               type="checkbox"
                               id="med-@m.IdMedicine"
                               name="isTaken"
                               value="true"
                               checked="@(Model.TakenMedicineIds.Contains(m.IdMedicine))"
                               onchange="this.form.submit();"
                               disabled="@(isFutureDay ? "disabled" : null)" />
                    </form>
                </li>
            }
        </ul>
    </div>
}


@if (Model.Noon.Any())
{
    <div class="card mb-3">
        <div class="card-header text-center">
            Południe
        </div>
        <ul class="list-group list-group-flush">
            @foreach (var m in Model.Noon)
            {
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <label class="mb-0 flex-grow-1" for="med-@m.IdMedicine">
                        @m.MedicineName – @m.Dosage
                    </label>

                    <form asp-action="ToggleMedicineTaken" method="post" class="m-0">
                        @Html.AntiForgeryToken()

                        <input type="hidden" name="date" value="@Model.Date.ToString("yyyy-MM-dd")" />
                        <input type="hidden" name="treatmentPlanMedicineId" value="@m.IdMedicine" />

                        <input class="form-check-input ms-2"
                               type="checkbox"
                               id="med-@m.IdMedicine"
                               name="isTaken"
                               value="true"
                               checked="@(Model.TakenMedicineIds.Contains(m.IdMedicine))"
                               onchange="this.form.submit();"
                               disabled="@(isFutureDay ? "disabled" : null)" />
                    </form>
                </li>
            }
        </ul>
    </div>
}


@if (Model.Afternoon.Any())
{
    <div class="card mb-3">
        <div class="card-header text-center">
            Popołudnie
        </div>
        <ul class="list-group list-group-flush">
            @foreach (var m in Model.Afternoon)
            {
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <label class="mb-0 flex-grow-1" for="med-@m.IdMedicine">
                        @m.MedicineName – @m.Dosage
                    </label>

                    <form asp-action="ToggleMedicineTaken" method="post" class="m-0">
                        @Html.AntiForgeryToken()

                        <input type="hidden" name="date" value="@Model.Date.ToString("yyyy-MM-dd")" />
                        <input type="hidden" name="treatmentPlanMedicineId" value="@m.IdMedicine" />

                        <input class="form-check-input ms-2"
                               type="checkbox"
                               id="med-@m.IdMedicine"
                               name="isTaken"
                               value="true"
                               checked="@(Model.TakenMedicineIds.Contains(m.IdMedicine))"
                               onchange="this.form.submit();"
                               disabled="@(isFutureDay ? "disabled" : null)" />
                    </form>
                </li>
            }
        </ul>
    </div>
}


@if (Model.Evening.Any())
{
    <div class="card mb-3">
        <div class="card-header text-center">
            Wieczorem
        </div>
        <ul class="list-group list-group-flush">
            @foreach (var m in Model.Evening)
            {
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <label class="mb-0 flex-grow-1" for="med-@m.IdMedicine">
                        @m.MedicineName – @m.Dosage
                    </label>

                    <form asp-action="ToggleMedicineTaken" method="post" class="m-0">
                        @Html.AntiForgeryToken()

                        <input type="hidden" name="date" value="@Model.Date.ToString("yyyy-MM-dd")" />
                        <input type="hidden" name="treatmentPlanMedicineId" value="@m.IdMedicine" />

                        <input class="form-check-input ms-2"
                               type="checkbox"
                               id="med-@m.IdMedicine"
                               name="isTaken"
                               value="true"
                               checked="@(Model.TakenMedicineIds.Contains(m.IdMedicine))"
                               onchange="this.form.submit();"
                               disabled="@(isFutureDay ? "disabled" : null)" />
                    </form>
                </li>
            }
        </ul>
    </div>
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <a class="btn btn-outline-success"
       asp-action="Schedule"
       asp-route-date="@d.AddDays(-1).ToString("yyyy-MM-dd")">
        ← Poprzedni dzień
    </a>

    <a class="btn btn-success"
       asp-action="Schedule">
        Leki na dzisiaj
    </a>

    <a class="btn btn-outline-success"
       asp-action="Schedule"
       asp-route-date="@d.AddDays(1).ToString("yyyy-MM-dd")">
        Następny dzień →
    </a>
</div>